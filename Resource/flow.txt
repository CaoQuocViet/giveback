=== CHƯA ĐĂNG NHẬP ===

1. Trang chủ (/)
   - Xem bản đồ nhiệt (heatmap) thiên tai
   - Xem tin tức (newsfeed) thiên tai
   - Xem danh sách tổ chức từ thiện (chỉ xem được các tổ chức đã VERIFIED)
   - Xem danh sách chiến dịch (chỉ xem được các chiến dịch của tổ chức đã VERIFIED)
   - Đăng nhập/Đăng ký

2. Đăng ký (/auth/register)
   - Form đăng ký với các trường:
     + Email (unique)
     + Số điện thoại (unique, dùng để xác thực OTP)
     + Mật khẩu
     + Họ tên
     + Role (DONOR/CHARITY/BENEFICIARY)
     + Thông tin địa chỉ (tỉnh/huyện/xã/địa chỉ chi tiết)
   - Nếu role là CHARITY:
     + Thêm trường tên tổ chức
     + Thêm trường mô tả
     + Upload giấy phép hoạt động
     + Mô tả giấy phép

3. Đăng nhập (/auth/login)
   - Đăng nhập bằng email/phone + password
   - Sau khi đăng nhập thành công:
     + Chuyển đến dashboard tương ứng với role
     + Set token vào cookie/localStorage

=== ADMIN ===

1. Dashboard (/dashboard)
   - Sidebar menu:
     + Thông tin quản trị (/dashboard/profile)
     + Danh sách tổ chức (/dashboard/charities) 
     + Theo dõi báo cáo (/dashboard/reports)

2. Quản lý tổ chức (/dashboard/charities)
   - Xem danh sách tất cả tổ chức từ thiện
   - Filter theo trạng thái xác minh (PENDING/VERIFIED/REJECTED)
   - Xem chi tiết tổ chức (/dashboard/charities/[id])
   
3. Chi tiết tổ chức (/dashboard/charities/[id])
   - Xem thông tin chi tiết tổ chức
   - Xem giấy phép hoạt động
   - Nếu tổ chức đang PENDING:
     + Nút "Xác thực" -> Chuyển status thành VERIFIED
     + Nút "Buộc dừng" -> Chuyển status thành REJECTED
   - Xem danh sách chiến dịch của tổ chức
   
4. Theo dõi báo cáo (/dashboard/reports)
   - Xem tất cả báo cáo theo loại:
     + Báo cáo theo chiến dịch
     + Báo cáo tổng hợp theo tổ chức
     + Báo cáo đóng góp
     + Báo cáo hỗ trợ
   - Export báo cáo (PDF/Excel)

=== TỔ CHỨC TỪ THIỆN (CHARITY) ===

1. Dashboard (/dashboard)
   - Sidebar menu:
     + Thông tin tổ chức (/dashboard/profile)
     + Danh sách tổ chức (/dashboard/charities)
     + Quản lý chiến dịch (/dashboard/campaigns)
     + Theo dõi báo cáo (/dashboard/reports)

2. Quản lý chiến dịch (/dashboard/campaigns)
   - Xem danh sách chiến dịch của tổ chức
   - Thêm chiến dịch mới với các thông tin:
     + Tên chiến dịch
     + Mô tả
     + Mục tiêu chi tiết
     + Địa điểm (tỉnh/huyện/xã/địa chỉ)
     + Ngày bắt đầu
     + Ngày kết thúc
     + Mục tiêu quyên góp (target_amount)
     + Trạng thái (STARTING/ONGOING)
     + Upload ảnh chiến dịch
   - Sửa chiến dịch (nếu chưa COMPLETED):
     + Ngày kết thúc
     + Target amount
     + Mô tả chi tiết
     + Ảnh chiến dịch
     + Trạng thái (chỉ được tăng: STARTING -> ONGOING -> CLOSED -> COMPLETED)
   - Xóa chiến dịch (chỉ được xóa khi STARTING)

3. Chi tiết chiến dịch (/dashboard/campaigns/[id])
   - Xem thông tin chi tiết chiến dịch
   - Xem danh sách đóng góp
   - Tạo phân phối hỗ trợ mới:
     + Số tiền phân phối
     + Ngày phân phối
     + Địa điểm phân phối
     + Upload ảnh chứng minh
   - Xem danh sách phân phối hỗ trợ
   - Xem bình luận và phản hồi bình luận

4. Theo dõi báo cáo (/dashboard/reports)
   - Xem báo cáo của tổ chức:
     + Báo cáo theo chiến dịch
     + Báo cáo tổng hợp
     + Báo cáo đóng góp
     + Báo cáo hỗ trợ
   - Export báo cáo (PDF/Excel)

=== NGƯỜI ĐÓNG GÓP (DONOR) ===

1. Dashboard (/dashboard)
   - Sidebar menu:
     + Thông tin cá nhân (/dashboard/profile)
     + Danh sách tổ chức (/dashboard/charities)
     + Lịch sử đóng góp (/dashboard/donations)
     + Theo dõi báo cáo (/dashboard/reports)

2. Xem danh sách tổ chức (/dashboard/charities)
   - Chỉ xem được các tổ chức đã VERIFIED
   - Xem chi tiết tổ chức
   - Đánh giá tổ chức (rating)
   
3. Chi tiết chiến dịch (/dashboard/campaigns/[id])
   - Xem thông tin chi tiết
   - Nút đóng góp (nếu chiến dịch đang ONGOING):
     + Chọn số tiền đóng góp
     + Chọn phương thức thanh toán
     + Thêm ghi chú (nếu có)
     + Xác nhận thanh toán
     + Chuyển đến trang thanh toán
     + Callback từ cổng thanh toán -> cập nhật trạng thái đóng góp
   - Bình luận với cờ DONOR
   - Nếu đã đóng góp thành công:
     + Bình luận với cờ đã_đóng_góp
     + Đánh giá chiến dịch (rating)

4. Lịch sử đóng góp (/dashboard/donations)
   - Xem danh sách các lần đóng góp
   - Filter theo trạng thái (PENDING/SUCCESS/FAILED)
   - Xem chi tiết từng lần đóng góp

5. Theo dõi báo cáo (/dashboard/reports)
   - Xem báo cáo đóng góp cá nhân
   - Xem báo cáo tổng hợp các chiến dịch đã đóng góp
   - Export báo cáo (PDF/Excel)

=== NGƯỜI NHẬN HỖ TRỢ (BENEFICIARY) ===

1. Dashboard (/dashboard)
   - Sidebar menu:
     + Thông tin cá nhân (/dashboard/profile)
     + Danh sách tổ chức (/dashboard/charities)
     + Theo dõi báo cáo (/dashboard/reports)

2. Xem danh sách tổ chức (/dashboard/charities)
   - Chỉ xem được các tổ chức đã VERIFIED
   - Xem chi tiết tổ chức và các chiến dịch

3. Chi tiết chiến dịch (/dashboard/campaigns/[id])
   - Xem thông tin chi tiết
   - Bình luận với cờ BENEFICIARY
   - Nếu đã nhận hỗ trợ:
     + Bình luận với cờ đã_nhận
     + Xác nhận đã nhận hỗ trợ

4. Theo dõi báo cáo (/dashboard/reports)
   - Xem báo cáo hỗ trợ đã nhận
   - Xem báo cáo tổng hợp các chiến dịch liên quan
   - Export báo cáo (PDF/Excel)

=== LUỒNG XỬ LÝ CHÍNH ===

1. Xác thực tổ chức:
   PENDING -> Admin xác thực -> VERIFIED/REJECTED

2. Quản lý chiến dịch:
   STARTING -> Tổ chức bắt đầu -> ONGOING -> 
   (Hết hạn/Đủ tiền) -> CLOSED -> 
   (Đã phân phối hết) -> COMPLETED

3. Đóng góp:
   Chọn chiến dịch -> Nhập thông tin đóng góp ->
   PENDING -> Thanh toán thành công -> SUCCESS/FAILED ->
   Cập nhật số tiền cho chiến dịch

4. Phân phối hỗ trợ:
   Tạo kế hoạch phân phối -> Upload bằng chứng ->
   Người nhận xác nhận -> Cập nhật trạng thái

=== LUỒNG ĐÁNH GIÁ ===

1. Đánh giá chiến dịch:
   - Tất cả user (ADMIN/DONOR/CHARITY/BENEFICIARY) đều có thể đánh giá
   - Flow đánh giá:
     + User comment về chiến dịch 
     + Chọn số sao (0-5)
     + Backend tạo rating mới liên kết với comment
     + Trigger tính lại rating trung bình của chiến dịch:
       > Lấy tất cả rating của chiến dịch
       > Tính trung bình và cập nhật vào campaigns.rating
       > Trigger tính lại rating của tổ chức:
         * Lấy rating trung bình của tất cả chiến dịch của tổ chức
         * Cập nhật vào charities.rating

2. Hiển thị rating:
   - Trang chi tiết chiến dịch:
     + Hiển thị số sao trung bình
     + Danh sách comment có rating
     + Filter comment theo số sao
   - Trang chi tiết tổ chức:
     + Hiển thị số sao trung bình (tính từ rating các chiến dịch)
     + Top chiến dịch được đánh giá cao

3. Query tối ưu:
   - Dùng materialized view để cache rating trung bình
   - Chỉ tính lại khi có rating mới
   - Index cho các trường thường query
